{% extends 'base.html' %}

{% block title %}×“××©×‘×•×¨×“ ×‘×§×¨×•×ª ××™×›×•×ª - ××¢×¨×›×ª ××™×œ× ×§×•{% endblock %}

{% block content %}
<h2 class="mb-4 text-center">ğŸ§ª ×“××©×‘×•×¨×“ ×‘×§×¨×•×ª ××™×›×•×ª</h2>

<a href="{{ url_for('quality.export_quality_excel') }}" class="btn btn-outline-success d-flex align-items-center gap-2 mb-3" style="width: fit-content;">
  <img src="https://cdn-icons-png.flaticon.com/512/732/732220.png" alt="Excel Icon" width="24" height="24">
  ×™×™×¦×•× ×œ××§×¡×œ
</a>


 <!-- ğŸ” ×˜×•×¤×¡ ×¡×™× ×•×Ÿ -->
  <form method="get" class="mb-4">
    <div class="row g-2">
      <div class="col-md-3">
        <label>×œ×§×•×—:</label>
        <input type="text" name="customer" class="form-control" value="{{ request.args.get('customer', '') }}">
      </div>
      <div class="col-md-3">
        <label>××ª××¨×™×š:</label>
        <input type="date" name="from_date" class="form-control" value="{{ request.args.get('from_date', '') }}">
      </div>
      <div class="col-md-3">
        <label>×¢×“ ×ª××¨×™×š:</label>
        <input type="date" name="to_date" class="form-control" value="{{ request.args.get('to_date', '') }}">
      </div>
      <div class="col-md-2">
        <label>××¦×‘ ×‘×§×¨×”:</label>
        <select name="quality_status" class="form-select">
          <option value="">×”×›×œ</option>
          <option value="×¢×‘×¨" {% if request.args.get('quality_status') == '×¢×‘×¨' %}selected{% endif %}> 	âœ… ×¢×‘×¨ </option>
          <option value="× ×›×©×œ" {% if request.args.get('quality_status') == '× ×›×©×œ' %}selected{% endif %}>âŒ × ×›×©×œ</option>
          <option value="pending" {% if request.args.get('quality_status') == 'pending' %}selected{% endif %}>â³ ×œ× ×‘×•×¦×¢</option>
        </select>
      </div>
      <div class="col-md-1 align-self-end">
        <button type="submit" class="btn btn-primary w-100">×¡× ×Ÿ</button>
      </div>
    </div>
  </form>
<!-- ğŸ“‹ ×˜×‘×œ×ª ×‘×§×¨×•×ª -->
<table class="table table-bordered table-striped shadow-sm">
    <thead class="table-light">
        <tr>
            <th>××¡×¤×¨ ×ª×•×›× ×™×ª</th>
            <th>×ª××¨×™×š</th>
            <th>×œ×§×•×—</th>
            <th>×¡×˜×˜×•×¡ ×ª×•×›× ×™×ª</th>
            <th>××¦×‘ ×‘×§×¨×”</th>
            <th>×”×¢×¨×•×ª</th>
            <th>×¤×¢×•×œ×”</th>
        </tr>
    </thead>
    <tbody>
        {% for row in checks %}
        <tr>
            <td>{{ row.id }}</td>
            <td>{{ row.date }}</td>
            <td>{{ row.customer }}</td>
            <td>{{ row.status }}</td>
            <td>
                {% if row.quality_status == '×¢×‘×¨' %}
                    <span class="text-success">âœ… ×¢×‘×¨</span>
                {% elif row.quality_status == '× ×›×©×œ' %}
                    <span class="text-danger">âŒ × ×›×©×œ</span>
                {% else %}
                    <span class="text-secondary">â³ ×œ× ×‘×•×¦×¢</span>
                {% endif %}
            </td>
            <td>{{ row.quality_notes or '-' }}</td>
            <td>
                {% if row.status == '×××ª×™×Ÿ ×œ×‘×§×¨×ª ××™×›×•×ª' and not row.quality_status %}
                    <a href="{{ url_for('quality.quality_check', plan_id=row.id) }}" class="btn btn-warning btn-sm">×‘×¦×¢ ×‘×§×¨×”</a>
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr><td colspan="7" class="text-center text-muted">×œ× × ××¦××• ×ª×•×¦××•×ª ×ª×•×××•×ª</td></tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/quality_dashboard.js') }}"></script>
{% endblock %}